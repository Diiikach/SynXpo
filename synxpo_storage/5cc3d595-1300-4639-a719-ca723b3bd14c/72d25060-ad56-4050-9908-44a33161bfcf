"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –∏ –∂–µ—Ä–µ–±—å—ë–≤–∫–µ.
"""
from database import Database


def main():
    db = Database()
    session = db.get_session()
    
    try:
        from database import User, Match
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
        all_users = session.query(User).all()
        registered_users = session.query(User).filter_by(is_registered=True).all()
        users_with_wishlist = session.query(User).filter_by(
            is_registered=True,
            has_filled_wishlist=True
        ).all()
        
        print("=" * 50)
        print("üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê")
        print("=" * 50)
        
        print(f"\nüë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:")
        print(f"  –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {len(all_users)}")
        print(f"  –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö: {len(registered_users)}")
        print(f"  –° –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –≤–∏—à–ª–∏—Å—Ç–æ–º: {len(users_with_wishlist)}")
        
        if registered_users:
            print(f"\nüìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏:")
            for user in registered_users:
                wishlist_status = "‚úÖ" if user.has_filled_wishlist else "‚ùå"
                print(f"  {wishlist_status} {user.first_name} (@{user.username or '–Ω–µ—Ç username'})")
        
        # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∂–µ—Ä–µ–±—å—ë–≤–∫–µ
        matches = session.query(Match).all()
        verified_matches = session.query(Match).filter_by(is_verified=True).all()
        sent_matches = session.query(Match).filter_by(is_sent=True).all()
        
        print(f"\nüéÖ –ñ–µ—Ä–µ–±—å—ë–≤–∫–∞:")
        print(f"  –í—Å–µ–≥–æ –ø–∞—Ä: {len(matches)}")
        print(f"  –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–æ: {len(verified_matches)}")
        print(f"  –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º: {len(sent_matches)}")
        
        if matches:
            print(f"\nüìã –ü–∞—Ä—ã –∂–µ—Ä–µ–±—å—ë–≤–∫–∏:")
            for match in matches:
                giver = session.query(User).filter_by(id=match.giver_id).first()
                receiver = session.query(User).filter_by(id=match.receiver_id).first()
                
                if giver and receiver:
                    verified = "‚úÖ" if match.is_verified else "‚è≥"
                    sent = "üì§" if match.is_sent else "‚è∏"
                    print(f"  {verified} {sent} {giver.first_name} ‚Üí {receiver.first_name}")
        
        print("\n" + "=" * 50)
        
    finally:
        session.close()


if __name__ == '__main__':
    main()

