"""
Скрипт для верификации результатов жеребьёвки.
После верификации можно отправлять результаты участникам.
"""
from database import Database


def main():
    db = Database()
    session = db.get_session()
    
    try:
        from database import Match, User
        
        matches = session.query(Match).all()
        
        if not matches:
            print("❌ Жеребьёвка ещё не проведена. Запустите run_matching.py")
            return
        
        print(f"Найдено пар: {len(matches)}")
        print("\nРезультаты жеребьёвки:")
        
        for match in matches:
            giver = session.query(User).filter_by(id=match.giver_id).first()
            receiver = session.query(User).filter_by(id=match.receiver_id).first()
            status = "✅ Верифицировано" if match.is_verified else "⏳ Не верифицировано"
            print(f"  {giver.first_name} → {receiver.first_name} ({status})")
        
        if all(m.is_verified for m in matches):
            print("\n✅ Все пары уже верифицированы.")
            return
        
        confirm = input("\nВерифицировать все пары? (yes/no): ")
        if confirm.lower() != 'yes':
            print("Верификация отменена.")
            return
        
        db.verify_matches()
        print("✅ Все пары успешно верифицированы!")
        print("Теперь можно отправлять результаты участникам через send_results.py")
        
    finally:
        session.close()


if __name__ == '__main__':
    main()

